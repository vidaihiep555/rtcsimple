/*
 * rtcninja-temasys.js v0.3.2
 * rtcninja.js module for the Temasys WebRTC plugin.
 * Copyright 2015 Temasys Communications Pte Ltd
 * Copyright 2015-2015 IÃ±aki Baz Castillo <inaki.baz@eface2face.com> (http://eface2face.com)
 * License Apache-2.0
 *
 * The original source has been modified in order to change the exposed API.
 */

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.rtcninjaTemasys=e()}}(function(){var e;return function n(e,o,t){function i(a,s){if(!o[a]){if(!e[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=o[a]={exports:{}};e[a][0].call(d.exports,function(n){var o=e[a][1][n];return i(o?o:n)},d,d.exports,n,e,o,t)}return o[a].exports}for(var r="function"==typeof require&&require,a=0;a<t.length;a++)i(t[a]);return i}({1:[function(e,n,o){(function(o){function t(e,n,o){e.addEventListener?e.addEventListener(n,o,!1):e.attachEvent&&e.attachEvent("on"+n,o)}function i(){if(m("injectPlugin()"),P=S.INJECTING,c.msie&&10>=w){var e=document.createDocumentFragment();for(x=document.createElement("div"),x.innerHTML='<object id="'+T.pluginId+'" type="'+T.type+'" width="1" height="1"><param name="pluginId" value="'+T.pluginId+'" /><param name="windowless" value="false" /><param name="pageId" value="'+L+'" /><param name="onload" value="'+T.onload+'" />'+(E.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+"</object>";x.firstChild;)e.appendChild(x.firstChild);document.body.appendChild(e),x=document.getElementById(T.pluginId)}else x=document.createElement("object"),x.id=T.pluginId,x.width="1px",x.height="1px",x.type=T.type,x.innerHTML='<param name="onload" value="'+T.onload+'"><param name="pluginId" value="'+T.pluginId+'"><param name="windowless" value="false" /> '+(E.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+'<param name="pageId" value="'+L+'">',document.body.appendChild(x);P=S.INJECTED}function r(){for(;P!==S.READY;);}function a(e){if(P===S.READY)e();else var n=setInterval(function(){P===S.READY&&(clearInterval(n),e())},100)}function s(){m("defineWebRTCInterface()"),P=S.INITIALIZING,f=function(e,n,o){e=e||{},e.audio=e.audio||!1,e.video=e.video||!1,a(function(){x.getUserMedia(e,n,o)})},p=function(e,n){e=e||{};for(var o=e.iceServers||[],t=0,i=o.length;i>t;t++)o[t].hasCredentials=o[t].hasOwnProperty("username")&&o[t].hasOwnProperty("credential");var a=n&&n.mandatory?n.mandatory:null,s=n&&n.optional?n.optional:null;return r(),x.PeerConnection(L,o,a,s)},g=function(e){return r(),x.ConstructSessionDescription(e.type,e.sdp)},v=function(e){return r(),x.ConstructIceCandidate(e.sdpMid||"",e.sdpMLineIndex,e.candidate)},h=function(){},h.getSources=function(e){a(function(){x.GetSources(e)})},y=function(e,n){if(e&&e.parentNode){var o;n?(n.enableSoundTracks(!0),o=n.id):o="";var i=0===e.id.length?Math.random().toString(36).slice(2):e.id,r=e.nodeName.toLowerCase();if("object"!==r){var a;switch(r){case"audio":a="audio";break;case"video":a="video";break;default:a="none"}var s=document.createDocumentFragment(),l=document.createElement("div"),d="";for(e.className?d='class="'+e.className+'" ':e.attributes&&e.attributes["class"]&&(d='class="'+e.attributes["class"].value+'" '),l.innerHTML='<object id="'+i+'" '+d+'type="'+T.type+'"><param name="pluginId" value="'+i+'" /> <param name="pageId" value="'+L+'" /> <param name="windowless" value="true" /> <param name="streamId" value="'+o+'" /> <param name="tag" value="'+a+'" /> </object>';l.firstChild;)s.appendChild(l.firstChild);var u="",m="";if(e.getBoundingClientRect){var f=e.getBoundingClientRect();m=f.width+"px",u=f.height+"px"}else e.width&&(m=e.width,u=e.height);e.parentNode.insertBefore(s,e),s=document.getElementById(i),s.width=m,s.height=u,e.parentNode.removeChild(e)}else{for(var p=e.children,g=0;g!==p.length;++g)if("streamId"===p[g].name){p[g].value=o;break}e.setStreamId(o)}var v=document.getElementById(i);return v.onplaying=e.onplaying?e.onplaying:function(){},v.onplay=e.onplay?e.onplay:function(){},v.onclick=e.onclick?e.onclick:function(){},c.msie&&(t(v,"playing",v.onplaying),t(v,"play",v.onplay),v.onclick=e.onclick?e.onclick:function(){},v._TemOnClick=function(e){var n={srcElement:document.getElementById(e)};v.onclick(n)}),v}},b=!0,d(function(){i()})}function l(e,n,o,t,i){return l.isRequired()?(n=n||{},u(E,e),u(T,n),m("TemasysPlugin() [pluginOptions:%o, pluginInfo:%o]",E,T),C&&n.downloadLinkSafari?T.downloadLink=n.downloadLinkSafari:I&&n.downloadLinkIE&&(T.downloadLink=n.downloadLinkIE),void(l.isInstalled()?(m("plugin already installed"),s(),N.getUserMedia=f,N.RTCPeerConnection=p,N.RTCSessionDescription=g,N.RTCIceCandidate=v,N.MediaStreamTrack=h,N.attachMediaStream=y,N.canRenegotiate=b,o&&o()):(m("plugin required but not installed"),N={},t&&t({isIE:c.msie,isSafari:c.safari,downloadLink:T.downloadLink})))):void(i&&i())}n.exports=l;var c=e("bowser"),d=e("domready"),u=e("merge"),m=e("debug")("rtcninja:TemasysPlugin"),f=null,p=null,g=null,v=null,h=null,y=null,b=!1,w=Number(c.version)||0,k=!(c.mobile&&c.tablet),I=!!navigator.platform.match(/^Win/i),C=!!navigator.platform.match(/^Mac/i),x=null,E={getAllCams:!1},T={prefix:"Tem",plugName:"TemWebRTCPlugin",pluginId:"plugin0",type:"application/x-temwebrtcplugin",onload:"__onTemasysPluginReady",portalLink:"http://temasys.atlassian.net/wiki/display/TWPP/WebRTC+Plugins",downloadLink:null,companyName:"Temasys"},N={};C?T.downloadLink="http://bit.ly/1n77hco":I&&(T.downloadLink="http://bit.ly/1kkS4FN");var L=Math.random().toString(36).slice(2),S={NONE:0,INITIALIZING:1,INJECTING:2,INJECTED:3,READY:4},P=S.NONE;o.__onTemasysPluginReady=function(){m("__onTemasysPluginReady()"),d(function(){P=S.READY})},l.isRequired=function(){return k&&c.msie&&I?!0:k&&c.safari&&C?!0:!1},l.isInstalled=function(){if(c.safari){for(var e=navigator.plugins,n=0,t=e.length;t>n;n++)if(e[n].name.indexOf(T.plugName)>=0)return!0;return!1}if(c.msie)try{{new o.ActiveXObject(T.prefix+"."+T.plugName)}return!0}catch(i){return!1}},l.monitorPluginInstallation=function(e,n,o,t){if(c.safari)return m("monitorPluginInstallation() | Safari requires restart, cannot monitor plugin installation"),!1;o=Number(o),t=Number(t),o||(o=3e3),t||(t=18e4),m("monitorPluginInstallation() | [interval: %dms | maxtime: %dms]",o,t);var i=null,r=setInterval(function(){l.isInstalled()&&(m("monitorPluginInstallation() | plugin installed"),clearInterval(r),clearTimeout(i),l(),e&&e())},o);return i=setTimeout(function(){m("monitorPluginInstallation() | monitoring ended"),clearInterval(r),n&&n()},t),!0},Object.defineProperty(l,"interface",{get:function(){return N}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{bowser:2,debug:3,domready:6,merge:7}],2:[function(n,o,t){!function(n,t){"undefined"!=typeof o&&o.exports?o.exports=t():"function"==typeof e&&e.amd?e(t):this[n]=t()}("bowser",function(){function e(e){function o(n){var o=e.match(n);return o&&o.length>1&&o[1]||""}function t(n){var o=e.match(n);return o&&o.length>1&&o[2]||""}var i,r=o(/(ipod|iphone|ipad)/i).toLowerCase(),a=/like android/i.test(e),s=!a&&/android/i.test(e),l=/CrOS/.test(e),c=o(/edge\/(\d+(\.\d+)?)/i),d=o(/version\/(\d+(\.\d+)?)/i),u=/tablet/i.test(e),m=!u&&/[^-]mobi/i.test(e);/opera|opr/i.test(e)?i={name:"Opera",opera:n,version:d||o(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(e)?i={name:"Yandex Browser",yandexbrowser:n,version:d||o(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(e)?(i={name:"Windows Phone",windowsphone:n},c?(i.msedge=n,i.version=c):(i.msie=n,i.version=o(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(e)?i={name:"Internet Explorer",msie:n,version:o(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:l?i={name:"Chrome",chromeBook:n,chrome:n,version:o(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(e)?i={name:"Microsoft Edge",msedge:n,version:c}:/chrome|crios|crmo/i.test(e)?i={name:"Chrome",chrome:n,version:o(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:r?(i={name:"iphone"==r?"iPhone":"ipad"==r?"iPad":"iPod"},d&&(i.version=d)):/sailfish/i.test(e)?i={name:"Sailfish",sailfish:n,version:o(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?i={name:"SeaMonkey",seamonkey:n,version:o(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(e)?(i={name:"Firefox",firefox:n,version:o(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(i.firefoxos=n)):/silk/i.test(e)?i={name:"Amazon Silk",silk:n,version:o(/silk\/(\d+(\.\d+)?)/i)}:s?i={name:"Android",version:d}:/phantom/i.test(e)?i={name:"PhantomJS",phantom:n,version:o(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?i={name:"BlackBerry",blackberry:n,version:d||o(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(e)?(i={name:"WebOS",webos:n,version:d||o(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(i.touchpad=n)):i=/bada/i.test(e)?{name:"Bada",bada:n,version:o(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(e)?{name:"Tizen",tizen:n,version:o(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||d}:/safari/i.test(e)?{name:"Safari",safari:n,version:d}:{name:o(/^(.*)\/(.*) /),version:t(/^(.*)\/(.*) /)},!i.msedge&&/(apple)?webkit/i.test(e)?(i.name=i.name||"Webkit",i.webkit=n,!i.version&&d&&(i.version=d)):!i.opera&&/gecko\//i.test(e)&&(i.name=i.name||"Gecko",i.gecko=n,i.version=i.version||o(/gecko\/(\d+(\.\d+)?)/i)),i.msedge||!s&&!i.silk?r&&(i[r]=n,i.ios=n):i.android=n;var f="";i.windowsphone?f=o(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):r?(f=o(/os (\d+([_\s]\d+)*) like mac os x/i),f=f.replace(/[_\s]/g,".")):s?f=o(/android[ \/-](\d+(\.\d+)*)/i):i.webos?f=o(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):i.blackberry?f=o(/rim\stablet\sos\s(\d+(\.\d+)*)/i):i.bada?f=o(/bada\/(\d+(\.\d+)*)/i):i.tizen&&(f=o(/tizen[\/\s](\d+(\.\d+)*)/i)),f&&(i.osversion=f);var p=f.split(".")[0];return u||"ipad"==r||s&&(3==p||4==p&&!m)||i.silk?i.tablet=n:(m||"iphone"==r||"ipod"==r||s||i.blackberry||i.webos||i.bada)&&(i.mobile=n),i.msedge||i.msie&&i.version>=10||i.yandexbrowser&&i.version>=15||i.chrome&&i.version>=20||i.firefox&&i.version>=20||i.safari&&i.version>=6||i.opera&&i.version>=10||i.ios&&i.osversion&&i.osversion.split(".")[0]>=6||i.blackberry&&i.version>=10.1?i.a=n:i.msie&&i.version<10||i.chrome&&i.version<20||i.firefox&&i.version<20||i.safari&&i.version<6||i.opera&&i.version<10||i.ios&&i.osversion&&i.osversion.split(".")[0]<6?i.c=n:i.x=n,i}var n=!0,o=e("undefined"!=typeof navigator?navigator.userAgent:"");return o.test=function(e){for(var n=0;n<e.length;++n){var t=e[n];if("string"==typeof t&&t in o)return!0}return!1},o._detect=e,o})},{}],3:[function(e,n,o){function t(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function i(){var e=arguments,n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+o.humanize(this.diff),!n)return e;var t="color: "+this.color;e=[e[0],t,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,r=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(r=i))}),e.splice(r,0,t),e}function r(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(e){try{null==e?o.storage.removeItem("debug"):o.storage.debug=e}catch(n){}}function s(){var e;try{e=o.storage.debug}catch(n){}return e}function l(){try{return window.localStorage}catch(e){}}o=n.exports=e("./debug"),o.log=r,o.formatArgs=i,o.save=a,o.load=s,o.useColors=t,o.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:l(),o.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],o.formatters.j=function(e){return JSON.stringify(e)},o.enable(s())},{"./debug":4}],4:[function(e,n,o){function t(){return o.colors[d++%o.colors.length]}function i(e){function n(){}function i(){var e=i,n=+new Date,r=n-(c||n);e.diff=r,e.prev=c,e.curr=n,c=n,null==e.useColors&&(e.useColors=o.useColors()),null==e.color&&e.useColors&&(e.color=t());var a=Array.prototype.slice.call(arguments);a[0]=o.coerce(a[0]),"string"!=typeof a[0]&&(a=["%o"].concat(a));var s=0;a[0]=a[0].replace(/%([a-z%])/g,function(n,t){if("%%"===n)return n;s++;var i=o.formatters[t];if("function"==typeof i){var r=a[s];n=i.call(e,r),a.splice(s,1),s--}return n}),"function"==typeof o.formatArgs&&(a=o.formatArgs.apply(e,a));var l=i.log||o.log||console.log.bind(console);l.apply(e,a)}n.enabled=!1,i.enabled=!0;var r=o.enabled(e)?i:n;return r.namespace=e,r}function r(e){o.save(e);for(var n=(e||"").split(/[\s,]+/),t=n.length,i=0;t>i;i++)n[i]&&(e=n[i].replace(/\*/g,".*?"),"-"===e[0]?o.skips.push(new RegExp("^"+e.substr(1)+"$")):o.names.push(new RegExp("^"+e+"$")))}function a(){o.enable("")}function s(e){var n,t;for(n=0,t=o.skips.length;t>n;n++)if(o.skips[n].test(e))return!1;for(n=0,t=o.names.length;t>n;n++)if(o.names[n].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}o=n.exports=i,o.coerce=l,o.disable=a,o.enable=r,o.enabled=s,o.humanize=e("ms"),o.names=[],o.skips=[],o.formatters={};var c,d=0},{ms:5}],5:[function(e,n,o){function t(e){if(e=""+e,!(e.length>1e4)){var n=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(n){var o=parseFloat(n[1]),t=(n[2]||"ms").toLowerCase();switch(t){case"years":case"year":case"yrs":case"yr":case"y":return o*u;case"days":case"day":case"d":return o*d;case"hours":case"hour":case"hrs":case"hr":case"h":return o*c;case"minutes":case"minute":case"mins":case"min":case"m":return o*l;case"seconds":case"second":case"secs":case"sec":case"s":return o*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o}}}}function i(e){return e>=d?Math.round(e/d)+"d":e>=c?Math.round(e/c)+"h":e>=l?Math.round(e/l)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function r(e){return a(e,d,"day")||a(e,c,"hour")||a(e,l,"minute")||a(e,s,"second")||e+" ms"}function a(e,n,o){return n>e?void 0:1.5*n>e?Math.floor(e/n)+" "+o:Math.ceil(e/n)+" "+o+"s"}var s=1e3,l=60*s,c=60*l,d=24*c,u=365.25*d;n.exports=function(e,n){return n=n||{},"string"==typeof e?t(e):n["long"]?r(e):i(e)}},{}],6:[function(n,o,t){!function(n,t){"undefined"!=typeof o?o.exports=t():"function"==typeof e&&"object"==typeof e.amd?e(t):this[n]=t()}("domready",function(){var e,n=[],o=document,t=o.documentElement.doScroll,i="DOMContentLoaded",r=(t?/^loaded|^c/:/^loaded|^i|^c/).test(o.readyState);return r||o.addEventListener(i,e=function(){for(o.removeEventListener(i,e),r=1;e=n.shift();)e()}),function(e){r?setTimeout(e,0):n.push(e)}})},{}],7:[function(e,n,o){!function(e){function o(e,n){if("object"!==i(e))return n;for(var t in n)e[t]="object"===i(e[t])&&"object"===i(n[t])?o(e[t],n[t]):n[t];return e}function t(e,n,t){var a=t[0],s=t.length;(e||"object"!==i(a))&&(a={});for(var l=0;s>l;++l){var c=t[l],d=i(c);if("object"===d)for(var u in c){var m=e?r.clone(c[u]):c[u];a[u]=n?o(a[u],m):m}}return a}function i(e){return{}.toString.call(e).slice(8,-1).toLowerCase()}var r=function(e){return t(e===!0,!1,arguments)},a="merge";r.recursive=function(e){return t(e===!0,!0,arguments)},r.clone=function(e){var n,o,t=e,a=i(e);if("array"===a)for(t=[],o=e.length,n=0;o>n;++n)t[n]=r.clone(e[n]);else if("object"===a){t={};for(n in e)t[n]=r.clone(e[n])}return t},e?n.exports=r:window[a]=r}("object"==typeof n&&n&&"object"==typeof n.exports&&n.exports)},{}]},{},[1])(1)});